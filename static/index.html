<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuantoniumOS - Web Desktop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        :root {
            --desktop-bg: #0a1520;
            --taskbar-bg: #111f30;
            --start-menu-bg: #102337;
            --window-bg: #0e1d2c;
            --window-header: #1a2a3a;
            --accent-color: #27a2ff;
            --text-color: #e2e8f0;
            --icon-color: #a0c0e0;
            --border-color: #2a4563;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            overflow: hidden;
            background-color: var(--desktop-bg);
            color: var(--text-color);
            height: 100vh;
            user-select: none;
        }

        .desktop {
            width: 100%;
            height: calc(100vh - 40px);
            position: relative;
            overflow: hidden;
            background-image: linear-gradient(to bottom right, rgba(20, 40, 80, 0.2), rgba(0, 10, 30, 0.4)), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 100 100"><rect fill="%23102030" width="100" height="100"/><g fill="%231a3050"><circle cx="10" cy="10" r="1"/><circle cx="30" cy="10" r="1"/><circle cx="50" cy="10" r="1"/><circle cx="70" cy="10" r="1"/><circle cx="90" cy="10" r="1"/><circle cx="20" cy="20" r="1"/><circle cx="40" cy="20" r="1"/><circle cx="60" cy="20" r="1"/><circle cx="80" cy="20" r="1"/><circle cx="10" cy="30" r="1"/><circle cx="30" cy="30" r="1"/><circle cx="50" cy="30" r="1"/><circle cx="70" cy="30" r="1"/><circle cx="90" cy="30" r="1"/><circle cx="20" cy="40" r="1"/><circle cx="40" cy="40" r="1"/><circle cx="60" cy="40" r="1"/><circle cx="80" cy="40" r="1"/><circle cx="10" cy="50" r="1"/><circle cx="30" cy="50" r="1"/><circle cx="50" cy="50" r="1"/><circle cx="70" cy="50" r="1"/><circle cx="90" cy="50" r="1"/><circle cx="20" cy="60" r="1"/><circle cx="40" cy="60" r="1"/><circle cx="60" cy="60" r="1"/><circle cx="80" cy="60" r="1"/><circle cx="10" cy="70" r="1"/><circle cx="30" cy="70" r="1"/><circle cx="50" cy="70" r="1"/><circle cx="70" cy="70" r="1"/><circle cx="90" cy="70" r="1"/><circle cx="20" cy="80" r="1"/><circle cx="40" cy="80" r="1"/><circle cx="60" cy="80" r="1"/><circle cx="80" cy="80" r="1"/><circle cx="10" cy="90" r="1"/><circle cx="30" cy="90" r="1"/><circle cx="50" cy="90" r="1"/><circle cx="70" cy="90" r="1"/><circle cx="90" cy="90" r="1"/></g></svg>');
        }

        .taskbar {
            height: 40px;
            background-color: var(--taskbar-bg);
            border-top: 1px solid var(--border-color);
            position: fixed;
            bottom: 0;
            width: 100%;
            display: flex;
            z-index: 9999;
        }

        .start-btn {
            width: 50px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border-right: 1px solid var(--border-color);
            transition: background-color 0.1s;
        }

        .start-btn:hover {
            background-color: var(--accent-color);
        }

        .start-btn i {
            font-size: 20px;
            color: var(--icon-color);
        }

        .task-container {
            display: flex;
            flex-grow: 1;
            height: 100%;
            padding: 0 10px;
        }

        .task-item {
            min-width: 160px;
            height: 40px;
            display: flex;
            align-items: center;
            padding: 0 10px;
            margin-right: 5px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.1s;
        }

        .task-item.active {
            background-color: rgba(39, 162, 255, 0.2);
            border-bottom: 2px solid var(--accent-color);
        }

        .task-item:hover {
            background-color: rgba(39, 162, 255, 0.1);
        }

        .task-item i {
            margin-right: 8px;
            font-size: 16px;
            color: var(--icon-color);
        }

        .clock {
            width: 110px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-left: 1px solid var(--border-color);
            font-size: 14px;
        }

        .start-menu {
            position: absolute;
            bottom: 40px;
            left: 0;
            width: 320px;
            height: 500px;
            background-color: var(--start-menu-bg);
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            z-index: 9999;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .start-menu.show {
            display: flex;
        }

        .start-menu-header {
            height: 60px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .start-menu-header .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--accent-color);
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
        }

        .start-menu-header .user-avatar i {
            font-size: 20px;
            color: white;
        }

        .start-menu-header .user-name {
            font-size: 16px;
            font-weight: bold;
        }

        .start-menu-search {
            padding: 10px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .start-menu-search input {
            width: 100%;
            padding: 8px 15px;
            border-radius: 15px;
            border: none;
            outline: none;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
        }

        .start-menu-search input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .start-menu-apps {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 10px;
        }

        .app-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 90px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.1s;
            padding: 5px;
        }

        .app-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .app-item i {
            font-size: 24px;
            margin-bottom: 5px;
            color: var(--icon-color);
        }

        .app-item .app-name {
            font-size: 12px;
            text-align: center;
        }

        .desktop-icons {
            position: absolute;
            top: 15px;
            left: 15px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80px;
            cursor: pointer;
        }

        .desktop-icon:hover .icon-container {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .desktop-icon .icon-container {
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 5px;
            transition: background-color 0.1s;
        }

        .desktop-icon i {
            font-size: 24px;
            color: var(--icon-color);
        }

        .desktop-icon .icon-name {
            margin-top: 5px;
            font-size: 12px;
            text-align: center;
            max-width: 80px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .windows-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .window {
            position: absolute;
            background-color: var(--window-bg);
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            min-width: 300px;
            min-height: 200px;
            pointer-events: auto;
            overflow: hidden;
        }

        .window-header {
            height: 35px;
            background-color: var(--window-header);
            display: flex;
            align-items: center;
            padding: 0 10px;
            cursor: move;
        }

        .window-title {
            flex-grow: 1;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .window-controls {
            display: flex;
        }

        .window-control {
            width: 25px;
            height: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border-radius: 3px;
            margin-left: 5px;
            transition: background-color 0.1s;
        }

        .window-control:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .window-control.close:hover {
            background-color: #e81123;
        }

        .window-control i {
            font-size: 14px;
        }

        .window-content {
            flex-grow: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        .window-content iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background-color: var(--window-bg);
            border: 1px solid var(--border-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            min-width: 200px;
            display: none;
            z-index: 10000;
        }

        .context-menu.show {
            display: block;
        }

        .context-menu-item {
            padding: 8px 15px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .context-menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .context-menu-item i {
            margin-right: 10px;
            font-size: 14px;
            width: 16px;
            text-align: center;
            color: var(--icon-color);
        }

        .context-separator {
            height: 1px;
            background-color: var(--border-color);
            margin: 5px 0;
        }
        
        /* Hide scrollbar for Chrome, Safari and Opera */
        .start-menu-apps::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        .start-menu-apps {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        
        .tooltip {
            position: absolute;
            background-color: var(--window-header);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .tooltip.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="desktop">
        <div class="desktop-icons">
            <div class="desktop-icon" data-app="qbrowser">
                <div class="icon-container">
                    <i class="fas fa-globe"></i>
                </div>
                <div class="icon-name">Q-Browser</div>
            </div>
            <div class="desktop-icon" data-app="qmail">
                <div class="icon-container">
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="icon-name">Q-Mail</div>
            </div>
            <div class="desktop-icon" data-app="quantum-grid">
                <div class="icon-container">
                    <i class="fas fa-project-diagram"></i>
                </div>
                <div class="icon-name">Quantum Grid</div>
            </div>
            <div class="desktop-icon" data-app="qubit-visualizer">
                <div class="icon-container">
                    <i class="fas fa-atom"></i>
                </div>
                <div class="icon-name">Qubit Visualizer</div>
            </div>
        </div>

        <div class="windows-container"></div>
    </div>

    <div class="taskbar">
        <div class="start-btn">
            <i class="fas fa-wave-square"></i>
        </div>
        <div class="task-container"></div>
        <div class="clock"></div>
    </div>

    <div class="start-menu">
        <div class="start-menu-header">
            <div class="user-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="user-name">Quantum User</div>
        </div>
        <div class="start-menu-search">
            <input type="text" placeholder="Search apps, settings, files...">
        </div>
        <div class="start-menu-apps">
            <div class="app-item" data-app="qbrowser">
                <i class="fas fa-globe"></i>
                <div class="app-name">Q-Browser</div>
            </div>
            <div class="app-item" data-app="qmail">
                <i class="fas fa-envelope"></i>
                <div class="app-name">Q-Mail</div>
            </div>
            <div class="app-item" data-app="quantum-grid">
                <i class="fas fa-project-diagram"></i>
                <div class="app-name">Quantum Grid</div>
            </div>
            <div class="app-item" data-app="qubit-visualizer">
                <i class="fas fa-atom"></i>
                <div class="app-name">Qubit Visualizer</div>
            </div>
            <div class="app-item" data-app="wave-visualizer">
                <i class="fas fa-wave-square"></i>
                <div class="app-name">Wave Visualizer</div>
            </div>
            <div class="app-item" data-app="encryption">
                <i class="fas fa-lock"></i>
                <div class="app-name">Encryption</div>
            </div>
            <div class="app-item" data-app="qnotes">
                <i class="fas fa-sticky-note"></i>
                <div class="app-name">Q-Notes</div>
            </div>
            <div class="app-item" data-app="qvault">
                <i class="fas fa-vault"></i>
                <div class="app-name">Q-Vault</div>
            </div>
            <div class="app-item" data-app="qwavecomposer">
                <i class="fas fa-music"></i>
                <div class="app-name">Wave Composer</div>
            </div>
            <div class="app-item" data-app="debugger">
                <i class="fas fa-bug"></i>
                <div class="app-name">Wave Debugger</div>
            </div>
            <div class="app-item" data-app="settings">
                <i class="fas fa-cog"></i>
                <div class="app-name">Settings</div>
            </div>
            <div class="app-item" data-app="terminal">
                <i class="fas fa-terminal"></i>
                <div class="app-name">Terminal</div>
            </div>
        </div>
    </div>

    <div class="context-menu">
        <div class="context-menu-item" data-action="view">
            <i class="fas fa-eye"></i>
            <span>View</span>
        </div>
        <div class="context-menu-item" data-action="refresh">
            <i class="fas fa-sync"></i>
            <span>Refresh</span>
        </div>
        <div class="context-separator"></div>
        <div class="context-menu-item" data-action="new-folder">
            <i class="fas fa-folder-plus"></i>
            <span>New Folder</span>
        </div>
        <div class="context-menu-item" data-action="new-file">
            <i class="fas fa-file"></i>
            <span>New File</span>
        </div>
        <div class="context-separator"></div>
        <div class="context-menu-item" data-action="settings">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </div>
    </div>

    <div class="tooltip"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // App configuration
            const apps = {
                'qbrowser': {
                    title: 'Q-Browser',
                    icon: 'fas fa-globe',
                    url: '/quantum-browser',
                    width: 900,
                    height: 600
                },
                'qmail': {
                    title: 'Q-Mail',
                    icon: 'fas fa-envelope',
                    url: '/quantum-mail',
                    width: 800,
                    height: 550
                },
                'quantum-grid': {
                    title: 'Quantum Grid',
                    icon: 'fas fa-project-diagram',
                    url: '/quantum-grid',
                    width: 850,
                    height: 600
                },
                'qubit-visualizer': {
                    title: 'Qubit Visualizer',
                    icon: 'fas fa-atom',
                    url: '/qubit-visualizer',
                    width: 700,
                    height: 500
                },
                'wave-visualizer': {
                    title: 'Wave Visualizer',
                    icon: 'fas fa-wave-square',
                    url: '/wave-visualizer',
                    width: 700,
                    height: 500
                },
                'encryption': {
                    title: 'Encryption Tool',
                    icon: 'fas fa-lock',
                    url: '/',
                    width: 850,
                    height: 600
                },
                'qnotes': {
                    title: 'Q-Notes',
                    icon: 'fas fa-sticky-note',
                    url: '/quantum-notes',
                    width: 600,
                    height: 450
                },
                'qvault': {
                    title: 'Q-Vault',
                    icon: 'fas fa-shield-alt',
                    url: '/quantum-vault',
                    width: 700,
                    height: 500
                },
                'qwavecomposer': {
                    title: 'Wave Composer',
                    icon: 'fas fa-music',
                    url: '/wave-composer',
                    width: 800,
                    height: 550
                },
                'debugger': {
                    title: 'Wave Debugger',
                    icon: 'fas fa-bug',
                    url: '/wave-debugger',
                    width: 850,
                    height: 600
                },
                'settings': {
                    title: 'Settings',
                    icon: 'fas fa-cog',
                    url: '/settings',
                    width: 700,
                    height: 500
                },
                'terminal': {
                    title: 'Terminal',
                    icon: 'fas fa-terminal',
                    url: '/terminal',
                    width: 700,
                    height: 450
                }
            };
            
            // State management
            let windows = [];
            let activeWindow = null;
            let windowZIndex = 100;
            let startMenuOpen = false;
            let contextMenuOpen = false;
            
            // DOM Elements
            const desktop = document.querySelector('.desktop');
            const taskbar = document.querySelector('.taskbar');
            const startBtn = document.querySelector('.start-btn');
            const startMenu = document.querySelector('.start-menu');
            const taskContainer = document.querySelector('.task-container');
            const windowsContainer = document.querySelector('.windows-container');
            const contextMenu = document.querySelector('.context-menu');
            const clock = document.querySelector('.clock');
            const tooltip = document.querySelector('.tooltip');
            
            // Initialize the desktop
            function init() {
                updateClock();
                setInterval(updateClock, 1000);
                
                // Start menu toggle
                startBtn.addEventListener('click', toggleStartMenu);
                
                // Add event listeners for app items in start menu
                document.querySelectorAll('.app-item, .desktop-icon').forEach(item => {
                    item.addEventListener('click', (e) => {
                        const appId = item.dataset.app;
                        openApp(appId);
                        closeStartMenu();
                    });
                });
                
                // Context menu
                desktop.addEventListener('contextmenu', showContextMenu);
                
                // Close menus when clicking elsewhere
                document.addEventListener('click', (e) => {
                    if (startMenuOpen && !startMenu.contains(e.target) && !startBtn.contains(e.target)) {
                        closeStartMenu();
                    }
                    
                    if (contextMenuOpen && !contextMenu.contains(e.target)) {
                        closeContextMenu();
                    }
                });
                
                // Context menu items
                document.querySelectorAll('.context-menu-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        const action = item.dataset.action;
                        handleContextMenuAction(action);
                        closeContextMenu();
                    });
                });
                
                // Tooltips for desktop icons
                document.querySelectorAll('.desktop-icon').forEach(icon => {
                    icon.addEventListener('mouseenter', (e) => {
                        const appId = icon.dataset.app;
                        if (apps[appId]) {
                            showTooltip(apps[appId].title, e);
                        }
                    });
                    
                    icon.addEventListener('mouseleave', () => {
                        hideTooltip();
                    });
                    
                    icon.addEventListener('mousemove', (e) => {
                        updateTooltipPosition(e);
                    });
                });
                
                // Open default apps
                openApp('quantum-grid');
            }
            
            // Clock update
            function updateClock() {
                const now = new Date();
                let hours = now.getHours();
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const ampm = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12;
                hours = hours ? hours : 12;
                clock.textContent = `${hours}:${minutes} ${ampm}`;
            }
            
            // Start Menu management
            function toggleStartMenu() {
                if (startMenuOpen) {
                    closeStartMenu();
                } else {
                    openStartMenu();
                }
            }
            
            function openStartMenu() {
                startMenu.classList.add('show');
                startMenuOpen = true;
            }
            
            function closeStartMenu() {
                startMenu.classList.remove('show');
                startMenuOpen = false;
            }
            
            // Context Menu
            function showContextMenu(e) {
                e.preventDefault();
                
                // Position the context menu at the cursor position
                contextMenu.style.left = `${e.clientX}px`;
                contextMenu.style.top = `${e.clientY}px`;
                
                // Check boundaries and adjust if necessary
                const menuRect = contextMenu.getBoundingClientRect();
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;
                
                if (menuRect.right > windowWidth) {
                    contextMenu.style.left = `${windowWidth - menuRect.width - 5}px`;
                }
                
                if (menuRect.bottom > windowHeight) {
                    contextMenu.style.top = `${windowHeight - menuRect.height - 5}px`;
                }
                
                contextMenu.classList.add('show');
                contextMenuOpen = true;
            }
            
            function closeContextMenu() {
                contextMenu.classList.remove('show');
                contextMenuOpen = false;
            }
            
            function handleContextMenuAction(action) {
                switch(action) {
                    case 'refresh':
                        refreshDesktop();
                        break;
                    case 'settings':
                        openApp('settings');
                        break;
                    default:
                        console.log(`Context menu action: ${action}`);
                }
            }
            
            function refreshDesktop() {
                // Simulate refresh animation
                desktop.style.opacity = '0.8';
                setTimeout(() => {
                    desktop.style.opacity = '1';
                }, 300);
            }
            
            // Tooltip handling
            function showTooltip(text, e) {
                tooltip.textContent = text;
                updateTooltipPosition(e);
                tooltip.classList.add('show');
            }
            
            function hideTooltip() {
                tooltip.classList.remove('show');
            }
            
            function updateTooltipPosition(e) {
                tooltip.style.left = `${e.clientX + 15}px`;
                tooltip.style.top = `${e.clientY + 15}px`;
            }
            
            // Window management
            function openApp(appId) {
                // Check if app is already open
                const existingWindow = windows.find(w => w.appId === appId);
                if (existingWindow) {
                    bringToFront(existingWindow.id);
                    return;
                }
                
                if (!apps[appId]) {
                    console.error(`App ${appId} not found`);
                    return;
                }
                
                const app = apps[appId];
                const windowId = 'window-' + Date.now();
                
                // Create window
                const windowEl = document.createElement('div');
                windowEl.className = 'window';
                windowEl.dataset.id = windowId;
                windowEl.dataset.appId = appId;
                
                // Set initial position and size
                const viewportWidth = desktop.clientWidth;
                const viewportHeight = desktop.clientHeight;
                const left = Math.max(0, (viewportWidth - app.width) / 2);
                const top = Math.max(0, (viewportHeight - app.height) / 2);
                
                windowEl.style.width = `${app.width}px`;
                windowEl.style.height = `${app.height}px`;
                windowEl.style.left = `${left}px`;
                windowEl.style.top = `${top}px`;
                
                // Window content
                windowEl.innerHTML = `
                    <div class="window-header">
                        <div class="window-title"><i class="${app.icon}"></i> ${app.title}</div>
                        <div class="window-controls">
                            <div class="window-control minimize"><i class="fas fa-minus"></i></div>
                            <div class="window-control maximize"><i class="fas fa-expand"></i></div>
                            <div class="window-control close"><i class="fas fa-times"></i></div>
                        </div>
                    </div>
                    <div class="window-content">
                        <iframe src="${app.url}" frameborder="0"></iframe>
                    </div>
                `;
                
                // Add to DOM
                windowsContainer.appendChild(windowEl);
                
                // Add task item
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item active';
                taskItem.dataset.windowId = windowId;
                taskItem.innerHTML = `<i class="${app.icon}"></i> ${app.title}`;
                taskContainer.appendChild(taskItem);
                
                // Store window info
                const winInfo = {
                    id: windowId,
                    appId: appId,
                    element: windowEl,
                    taskItem: taskItem,
                    maximized: false,
                    originalSize: {
                        width: app.width,
                        height: app.height,
                        left: left,
                        top: top
                    }
                };
                
                windows.push(winInfo);
                activeWindow = winInfo;
                
                // Set active window
                setActiveWindow(windowId);
                
                // Window event listeners
                setupWindowListeners(windowEl, winInfo);
                
                // Task item click
                taskItem.addEventListener('click', () => {
                    if (windowEl.style.display === 'none') {
                        windowEl.style.display = 'flex';
                        taskItem.classList.add('active');
                    } else if (activeWindow && activeWindow.id === windowId) {
                        windowEl.style.display = 'none';
                        taskItem.classList.remove('active');
                    } else {
                        setActiveWindow(windowId);
                    }
                });
                
                return winInfo;
            }
            
            function setupWindowListeners(windowEl, winInfo) {
                const header = windowEl.querySelector('.window-header');
                const minimizeBtn = windowEl.querySelector('.window-control.minimize');
                const maximizeBtn = windowEl.querySelector('.window-control.maximize');
                const closeBtn = windowEl.querySelector('.window-control.close');
                
                // Window dragging
                let isDragging = false;
                let startX, startY, startLeft, startTop;
                
                header.addEventListener('mousedown', (e) => {
                    if (winInfo.maximized) return;
                    
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    startLeft = parseInt(windowEl.style.left);
                    startTop = parseInt(windowEl.style.top);
                    
                    // Set active window
                    setActiveWindow(winInfo.id);
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    
                    const dx = e.clientX - startX;
                    const dy = e.clientY - startY;
                    
                    windowEl.style.left = `${startLeft + dx}px`;
                    windowEl.style.top = `${startTop + dy}px`;
                });
                
                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
                
                // Minimize button
                minimizeBtn.addEventListener('click', () => {
                    windowEl.style.display = 'none';
                    winInfo.taskItem.classList.remove('active');
                });
                
                // Maximize button
                maximizeBtn.addEventListener('click', () => {
                    if (winInfo.maximized) {
                        // Restore
                        windowEl.style.width = `${winInfo.originalSize.width}px`;
                        windowEl.style.height = `${winInfo.originalSize.height}px`;
                        windowEl.style.left = `${winInfo.originalSize.left}px`;
                        windowEl.style.top = `${winInfo.originalSize.top}px`;
                        maximizeBtn.innerHTML = '<i class="fas fa-expand"></i>';
                    } else {
                        // Maximize
                        windowEl.style.width = '100%';
                        windowEl.style.height = '100%';
                        windowEl.style.left = '0';
                        windowEl.style.top = '0';
                        maximizeBtn.innerHTML = '<i class="fas fa-compress"></i>';
                    }
                    
                    winInfo.maximized = !winInfo.maximized;
                });
                
                // Close button
                closeBtn.addEventListener('click', () => {
                    closeWindow(winInfo.id);
                });
                
                // Set active on click
                windowEl.addEventListener('mousedown', () => {
                    setActiveWindow(winInfo.id);
                });
            }
            
            function setActiveWindow(windowId) {
                windows.forEach(win => {
                    const isActive = win.id === windowId;
                    win.element.style.zIndex = isActive ? ++windowZIndex : win.element.style.zIndex;
                    win.taskItem.classList.toggle('active', isActive);
                    
                    if (isActive) {
                        activeWindow = win;
                    }
                });
            }
            
            function bringToFront(windowId) {
                const win = windows.find(w => w.id === windowId);
                if (win) {
                    if (win.element.style.display === 'none') {
                        win.element.style.display = 'flex';
                    }
                    setActiveWindow(windowId);
                }
            }
            
            function closeWindow(windowId) {
                const index = windows.findIndex(w => w.id === windowId);
                if (index !== -1) {
                    const win = windows[index];
                    win.element.remove();
                    win.taskItem.remove();
                    windows.splice(index, 1);
                    
                    if (activeWindow && activeWindow.id === windowId) {
                        activeWindow = windows.length > 0 ? windows[windows.length - 1] : null;
                        if (activeWindow) {
                            setActiveWindow(activeWindow.id);
                        }
                    }
                }
            }
            
            // Initialize desktop
            init();
        });
    </script>
</body>
</html>